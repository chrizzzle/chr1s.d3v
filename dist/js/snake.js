"use strict";function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,i){for(var s=0;s<i.length;s++){var t=i[s];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,i,s){return i&&_defineProperties(e.prototype,i),s&&_defineProperties(e,s),e}var Snake=function(){function t(e,i,s){_classCallCheck(this,t),this._size=e,this._map=i,this._mapFields=i.getFields(),this._headField=s,this._directions={UP:"UP",DOWN:"DOWN",LEFT:"LEFT",RIGHT:"RIGHT"},this._direction=this._directions.UP,this.calcInitialSnakeFields(),this._interval=window.setInterval(this.step.bind(this),1e3),document.addEventListener("keydown",this.changeDirection.bind(this))}return _createClass(t,[{key:"changeDirection",value:function(e){if(!this._directionChanged)switch((e.key||e.keyCode).toUpperCase()){case"W":this._direction!==this._directions.DOWN&&this._direction!==this._directions.UP&&(this._direction=this._directions.UP,this._directionChanged=!0);break;case"S":this._direction!==this._directions.UP&&this._direction!==this._directions.DOWN&&(this._direction=this._directions.DOWN,this._directionChanged=!0);break;case"A":this._direction!==this._directions.RIGHT&&this._direction!==this._directions.LEFT&&(this._direction=this._directions.LEFT,this._directionChanged=!0);break;case"D":this._direction!==this._directions.LEFT&&this._direction!==this._directions.RIGHT&&(this._direction=this._directions.RIGHT,this._directionChanged=!0)}}},{key:"translateField",value:function(e){return e[0]>this._mapFields.length-1&&(e[0]=0),e[1]>this._mapFields.length-1&&(e[1]=0),e[0]<0&&(e[0]=this._mapFields.length-1),e[1]<0&&(e[1]=this._mapFields.length-1),e}},{key:"step",value:function(){this.calcNextHeadField(),this.checkIfCollision(),this.checkIfApple(),this.calcSnakeFields()}},{key:"calcNextHeadField",value:function(){switch(this._direction){case this._directions.RIGHT:this._headField=this.translateField([this._headField[0],this._headField[1]+1]);break;case this._directions.LEFT:this._headField=this.translateField([this._headField[0],this._headField[1]-1]);break;case this._directions.UP:this._headField=this.translateField([this._headField[0]-1,this._headField[1]]);break;case this._directions.DOWN:this._headField=this.translateField([this._headField[0]+1,this._headField[1]])}}},{key:"checkIfCollision",value:function(){var i=this;this._snakeFields.find(function(e){return e[0]===i._headField[0]&&e[1]===i._headField[1]})&&window.clearInterval(this._interval)}},{key:"checkIfApple",value:function(){"2"===this._map.getFields()[this._headField[0]][this._headField[1]]&&(this.addSnakeField(),this._map.placeApple())}},{key:"addSnakeField",value:function(){this._snakeFields.unshift(this._headField)}},{key:"calcSnakeFields",value:function(){this._lastField=this._snakeFields.pop(),this._snakeFields.unshift(this._headField),this.renderSnake()}},{key:"calcInitialSnakeFields",value:function(){this._snakeFields=[this._headField,this.translateField([this._headField[0],this._headField[1]-1]),this.translateField([this._headField[0],this._headField[1]-2])],this.renderSnake()}},{key:"renderSnake",value:function(){var e,i;this._lastField&&((i=document.querySelector(".field-".concat(this._lastField[0],"-").concat(this._lastField[1]))).classList.remove("snake"),i.classList.remove("snake--first"),i.classList.remove("snake--last"),i.classList.remove("snake--up"),i.classList.remove("snake--down"),i.classList.remove("snake--left"),i.classList.remove("snake--right"));for(var s=0;s<this._snakeFields.length;s++)(e=document.querySelector(".field-".concat(this._snakeFields[s][0],"-").concat(this._snakeFields[s][1]))).classList.add("snake"),e.classList.remove("snake--first"),e.classList.remove("snake--last"),e.classList.remove("snake--up"),e.classList.remove("snake--down"),e.classList.remove("snake--left"),e.classList.remove("snake--right"),0===s&&(e.classList.add("snake--first"),e.classList.add("snake--".concat(this._direction.toLowerCase()))),s===this._snakeFields.length-1&&(e.classList.add("snake--last"),e.classList.add("snake--".concat(this._direction.toLowerCase())));this._directionChanged=!1}}]),t}();