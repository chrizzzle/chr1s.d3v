"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Game=function(){function s(e,t,n,i){_classCallCheck(this,s),this._score=0,this._scoreElement=t,this._highscoreElement=n,this._mapElement=e,this._gameOverElement=i,this._map=new SnakeMap(15),this._map.render(this._mapElement),this._map.placeApple(),this._snake=new Snake(3,this._map,[10,10]),this.renderScore(),document.addEventListener("snake:dead",this.gameOver.bind(this)),document.addEventListener("snake:apple",this.foundApple.bind(this)),document.addEventListener("keydown",this.changeDirection.bind(this)),this.clickHandler=this.handleClick.bind(this)}return _createClass(s,[{key:"handleClick",value:function(e){var t=e.clientX,n=e.clientY;this._snake.handleClick([t,n])}},{key:"changeDirection",value:function(e){this._snake.changeDirection(e)}},{key:"reset",value:function(){this._mapElement.removeEventListener("click",this.clickHandler),this._score=0,this.renderScore(),this.hideGameOver(),this._snake.reset()}},{key:"start",value:function(){this._mapElement.addEventListener("click",this.clickHandler),this._snake.startMove()}},{key:"gameOver",value:function(){this._snake.stop(),this.renderGameOver()}},{key:"foundApple",value:function(){this._map.placeApple(this._snake.getFields()),this.increaseScore()}},{key:"increaseScore",value:function(){this._score++,this.saveHighscore(),this.renderScore()}},{key:"renderScore",value:function(){this._scoreElement.innerHTML=this._score,this.renderHighscore()}},{key:"renderGameOver",value:function(){this._gameOverElement.classList.remove("game-over--hidden")}},{key:"hideGameOver",value:function(){this._gameOverElement.classList.add("game-over--hidden")}},{key:"renderHighscore",value:function(){this._highscoreElement.innerHTML=localStorage.getItem("snake:highscore")||"0"}},{key:"saveHighscore",value:function(){if(window.localStorage){var e=localStorage.getItem("snake:highscore");e?(e=parseInt(e),this._score>e&&localStorage.setItem("snake:highscore",this._score)):localStorage.setItem("snake:highscore",this._score)}}}]),s}();