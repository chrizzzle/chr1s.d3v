{"version":3,"sources":["snake/src/js/snake.js"],"names":["Snake","size","map","startField","_classCallCheck","this","_size","_map","_mapFields","getFields","_originalHeadField","_headField","_directions","UP","RIGHT","_createClass","key","value","_interval","window","clearInterval","destroySnake","_direction","calcInitialSnakeFields","setInterval","step","bind","document","elementCoordinates","element","getBoundingClientRect","startMove","DOWN","coordinates","changeDirection","LEFT","_snakeFields","event","_directionChanged","toUpperCase","field","length","calcNextHeadField","checkIfCollision","checkIfApple","calcSnakeFields","translateField","lastField","snakeField","_this","initEvent","dispatchEvent","customEvent","addSnakeField","createEvent","nextField","calcNextTailField","_lastField","pop","found","unshift","renderSnake","fields","isAppleField","querySelectorAll","i","remove","classList","snakeDomField","concat","add","toLowerCase","querySelector"],"mappings":"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","file":"snake.js","sourcesContent":["class Snake {\n    constructor(size, map, startField) {\n        this._size = size;\n        this._map = map;\n        this._mapFields = map.getFields();\n        this._originalHeadField = startField;\n        this._headField = startField;\n        this._directions = {\n            UP: \"UP\",\n            DOWN: \"DOWN\",\n            LEFT: \"LEFT\",\n            RIGHT: \"RIGHT\"\n        };\n        this._direction = this._directions.RIGHT;\n        this.calcInitialSnakeFields();\n    }\n\n    reset() {\n        if (this._interval) {\n            window.clearInterval(this._interval);\n        }\n        this.destroySnake();\n        this._direction = this._directions.RIGHT;\n        this._headField = this._originalHeadField;\n        this.calcInitialSnakeFields();\n    }\n\n    startMove() {\n        this._interval = window.setInterval(this.step.bind(this), 120);\n    }\n\n    handleClick(coordinates) {\n        const element = document.querySelector(\".snake--first\");\n\n        if (!element) { return; }\n        const elementCoordinates = element.getBoundingClientRect();\n        switch(this._direction) {\n            case this._directions.UP:\n            case this._directions.DOWN:\n                if (elementCoordinates.x > coordinates[0]) {\n                    this.changeDirection({ key: \"A\" });\n                } else {\n                    this.changeDirection({ key: \"D\" });\n                }\n                return;\n\n            case this._directions.RIGHT:\n            case this._directions.LEFT:\n                if (elementCoordinates.y > coordinates[1]) {\n                    this.changeDirection({ key: \"W\" });\n                } else {\n                    this.changeDirection({ key: \"S\" });\n                }\n                return;\n        }\n    }\n\n    getFields() {\n        return this._snakeFields;\n    }\n\n    changeDirection(event) {\n        if (this._directionChanged) {\n            return;\n        }\n\n        const key = event.key;\n        switch (key.toUpperCase()) {\n            case \"W\":\n                if (this._direction !== this._directions.DOWN && this._direction !== this._directions.UP) {\n                    this._direction = this._directions.UP;\n                    this._directionChanged = true;\n                }\n                break;\n            case \"S\":\n                if (this._direction !== this._directions.UP && this._direction !== this._directions.DOWN) {\n                    this._direction = this._directions.DOWN;\n                    this._directionChanged = true;\n                }\n                break;\n            case \"A\":\n                if (this._direction !== this._directions.RIGHT && this._direction !== this._directions.LEFT) {\n                    this._direction = this._directions.LEFT;\n                    this._directionChanged = true;\n                }\n                break;\n            case \"D\":\n                if (this._direction !== this._directions.LEFT && this._direction !== this._directions.RIGHT) {\n                    this._direction = this._directions.RIGHT;\n                    this._directionChanged = true;\n                }\n                break;\n        }\n    }\n\n    translateField(field) {\n        if (field[0] > this._mapFields.length - 1) {\n            field[0] = 0;\n        }\n        if (field[1] > this._mapFields.length - 1) {\n            field[1] = 0;\n        }\n        if (field[0] < 0) {\n            field[0] = this._mapFields.length - 1;\n        }\n        if (field[1] < 0) {\n            field[1] = this._mapFields.length - 1;\n        }\n        return field;\n    }\n\n    step() {\n        this.calcNextHeadField();\n        this.checkIfCollision();\n        this.checkIfApple();\n        this.calcSnakeFields();\n    }\n\n    calcNextHeadField() {\n        switch (this._direction) {\n            case this._directions.RIGHT:\n                this._headField = this.translateField([this._headField[0], this._headField[1] + 1]);\n                break;\n            case this._directions.LEFT:\n                this._headField = this.translateField([this._headField[0], this._headField[1] - 1]);\n                break;\n            case this._directions.UP:\n                this._headField = this.translateField([this._headField[0] - 1, this._headField[1]]);\n                break;\n            case this._directions.DOWN:\n                this._headField = this.translateField([this._headField[0] + 1, this._headField[1]]);\n                break;\n        }\n    }\n    calcNextTailField() {\n        const lastField = this._snakeFields[this._snakeFields.length-1];\n        switch (this._direction) {\n            case this._directions.RIGHT:\n                return this.translateField([lastField[0], lastField[1] - 1]);\n            case this._directions.LEFT:\n                return this.translateField([lastField[0], lastField[1] + 1]);\n            case this._directions.UP:\n                return this.translateField([lastField[0] + 1, lastField[1]]);\n            case this._directions.DOWN:\n                return this.translateField([lastField[0] - 1, lastField[1]]);\n        }\n    }\n    checkIfCollision() {\n        const found = this._snakeFields.find( (snakeField) => {\n            return snakeField[0] === this._headField[0] &&\n                snakeField[1] === this._headField[1];\n        });\n\n        if (found) {\n            const customEvent = document.createEvent('HTMLEvents');\n            customEvent.initEvent('snake:dead', true, true);\n            document.dispatchEvent(customEvent);\n        }\n    }\n\n    stop() {\n        window.clearInterval(this._interval);\n    }\n\n    checkIfApple() {\n        if (this._map.isAppleField(this._headField)) {\n            this.addSnakeField();\n            const customEvent = document.createEvent('HTMLEvents');\n            customEvent.initEvent('snake:apple', true, true);\n            document.dispatchEvent(customEvent);\n        }\n    }\n\n    addSnakeField() {\n        const nextField = this.calcNextTailField();\n        this._snakeFields.push(nextField);\n    }\n\n    calcSnakeFields() {\n        this._lastField = this._snakeFields.pop();\n        this._snakeFields.unshift(this._headField);\n        this.renderSnake();\n    }\n\n    calcInitialSnakeFields() {\n        this._snakeFields = [\n            this._headField,\n            this.translateField([this._headField[0], this._headField[1] - 1]),\n            this.translateField([this._headField[0], this._headField[1] - 2])\n        ];\n        this.renderSnake();\n    }\n\n    destroySnake() {\n        const fields = document.querySelectorAll(\".snake\");\n\n        for (let i = 0; i < fields.length; i++) {\n            fields[i].classList.remove(\"snake\");\n            fields[i].classList.remove(\"snake--first\");\n            fields[i].classList.remove(\"snake--last\");\n            fields[i].classList.remove(\"snake--up\");\n            fields[i].classList.remove(\"snake--down\");\n            fields[i].classList.remove(\"snake--left\");\n            fields[i].classList.remove(\"snake--right\");\n        }\n    }\n\n    renderSnake() {\n        let snakeDomField, lastField;\n        if (this._lastField) {\n            lastField = document.querySelector(\n                `.field-${this._lastField[0]}-${this._lastField[1]}`\n            );\n            lastField.classList.remove(\"snake\");\n            lastField.classList.remove(\"snake--first\");\n            lastField.classList.remove(\"snake--last\");\n            lastField.classList.remove(\"snake--up\");\n            lastField.classList.remove(\"snake--down\");\n            lastField.classList.remove(\"snake--left\");\n            lastField.classList.remove(\"snake--right\");\n        }\n\n        for (let i = 0; i < this._snakeFields.length; i++) {\n            snakeDomField = document.querySelector(\n                `.field-${this._snakeFields[i][0]}-${this._snakeFields[i][1]}`\n            );\n            snakeDomField.classList.add(\"snake\");\n\n            snakeDomField.classList.remove(\"snake--first\");\n            snakeDomField.classList.remove(\"snake--last\");\n            snakeDomField.classList.remove(\"snake--up\");\n            snakeDomField.classList.remove(\"snake--down\");\n            snakeDomField.classList.remove(\"snake--left\");\n            snakeDomField.classList.remove(\"snake--right\");\n\n            if (i === 0) {\n                snakeDomField.classList.add(`snake--first`);\n                snakeDomField.classList.add(`snake--${this._direction.toLowerCase()}`);\n            }\n            if (i === this._snakeFields.length -1) {\n                snakeDomField.classList.add(`snake--last`);\n                snakeDomField.classList.add(`snake--${this._direction.toLowerCase()}`);\n            }\n        }\n\n        this._directionChanged = false;\n    }\n}"]}